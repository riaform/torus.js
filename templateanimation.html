<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>torus.js - Animated Templates</title>
    <link type="text/css" href="css/site.css" rel="stylesheet"/> 
    <script src="scripts/jquery-1.7.1.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        $.ajaxSetup({ cache: false });
        if (!window.console) console = { log: function () { }, clear: function () { } };
    </script>
    <script src="scripts/jquery-ui-1.8.18.js" type="text/javascript"></script>
    <script src="scripts/knockout.js" type="text/javascript"></script>
    <script src="js/MultiSelectViewModel.js" type="text/javascript"></script>
    <!-- Application Script Files -->
    </style>
    <script type="text/javascript">
        // create a view model with a target and source observable array
        function ViewModel() {
            this.target = ko.observableArray([{ name: 'Two' }]);
            this.source = [{ name: 'One' }, { name: 'Two' }, { name: 'Three' }, { name: 'Five' },
                            { name: 'Seven' }, { name: 'Eleven' }, { name: 'Thirteen' }, { name: 'Seventeen' },
                            { name: 'Nineteen' }, { name: 'Twenty-Three' }, { name: 'Twenty-Nine' }, { name: 'Thirty-One' }
                            ];

            // the 'people' property uses the MultiSelectViewModel passing four values:
            //   Target Array (observable)
            //   Source Array
            //   Identity function to test equality of the objects
            //   Container Selector for common parent
            this.people = new MultiSelectViewModel(this.target, this.source, function(obj) { return obj.name; });
        };

        // set-up VM and apply bindings
        $(function() {
            var vm = new ViewModel();
            ko.applyBindings(vm);
        });


        function log(str) {
            $("#log").append($("<p>").text(str));
        }

    </script>
    <!-- template to use to visualize the item - just use a span -->
    <script type="text/html" id="itemTemplate">
        <div class="item" data-bind="click: function() { if ($parent.selection.indexOf($data)>=0) $parent.selection.remove($data); else { $parent.selection.push($data); } }">
            <span data-bind="text: name"></span>
        </div>
    </script>
</head>
<body>
    <p>Two DIV areas (one source and one target) populated using a knockout foreach with a template based on an observable array.  Clicking
        on an element adds it to the target observable array.  Clicking it again removes it from the collection.
    </p>
    <div id="container">
        <div class="panel source" data-bind="with:people">
            <p>Target Array</p>
            <div data-bind="template: { name: 'itemTemplate', foreach: selection, afterAdd: afterAddTargetElement, beforeRemove: beforeRemoveTargetElement }">
            </div>
        </div>
        <div class="panel target" data-bind="with:people">
            <p>Source Array (populated using objects rendered with 'itemTemplate')</p>
            <div data-bind="template: { name: 'itemTemplate', foreach: source, beforeRemove: beforeRemoveSourceElement, afterAdd: afterAddSourceElement}">
            </div>
        </div>
        <div id="log"></div>
    </div>
</body>
</html>
